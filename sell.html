<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Classifieds App</title>
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .star-rating {
      display: flex;
      flex-direction: row-reverse;
      justify-content: flex-start;
    }
    .star-rating input {
      display: none;
    }
    .star-rating label {
      font-size: 2em;
      color: #FFD700;
      cursor: pointer;
    }
    .star-rating input:checked ~ label {
      color: #FFD700;
    }
    #messageBox {
      width: 100%;
      height: 300px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    .message {
      padding: 10px;
      margin-bottom: 5px;
      background-color: #f1f1f1;
    }
    .sender {
      text-align: right;
      background-color: #e0e0e0;
    }
  </style>
</head>
<body>

  <!-- User Authentication (Register/Login) -->
  <h2>Register</h2>
  <form id="registerForm">
    <input type="text" id="name" placeholder="Name" required><br>
    <input type="email" id="email" placeholder="Email" required><br>
    <input type="password" id="password" placeholder="Password" required><br>
    <button type="submit">Register</button>
  </form>

  <h2>Login</h2>
  <form id="loginForm">
    <input type="email" id="loginEmail" placeholder="Email" required><br>
    <input type="password" id="loginPassword" placeholder="Password" required><br>
    <button type="submit">Login</button>
  </form>

  <!-- Social Media Login (Google/Facebook) -->
  <h2>Or Login with</h2>
  <button onclick="socialLogin('google')">Login with Google</button>
  <button onclick="socialLogin('facebook')">Login with Facebook</button>

  <!-- Product Listing Form -->
  <h2>Post Product</h2>
  <form id="productForm" enctype="multipart/form-data">
    <input type="text" id="title" placeholder="Product Title" required><br>
    <textarea id="description" placeholder="Product Description" required></textarea><br>
    <input type="number" id="price" placeholder="Price" required><br>
    <select id="category">
      <option value="electronics">Electronics</option>
      <option value="furniture">Furniture</option>
      <option value="vehicles">Vehicles</option>
      <option value="fashion">Fashion</option>
    </select><br>
    <input type="file" id="images" multiple><br>
    <button type="submit">Post Product</button>
  </form>

  <!-- Search & Filter -->
  <h2>Search Products</h2>
  <input type="text" id="searchKeyword" placeholder="Enter keywords"><br>
  <label>Category: </label>
  <select id="searchCategory">
    <option value="">All</option>
    <option value="electronics">Electronics</option>
    <option value="furniture">Furniture</option>
    <option value="vehicles">Vehicles</option>
    <option value="fashion">Fashion</option>
  </select><br>
  <label>Price Range: </label>
  <input type="number" id="minPrice" placeholder="Min Price">
  <input type="number" id="maxPrice" placeholder="Max Price"><br>
  <button onclick="searchProducts()">Search</button>
  <div id="searchResults"></div>

  <!-- Messaging System -->
  <h2>Message Seller</h2>
  <div id="messageBox"></div>
  <input type="text" id="messageInput" placeholder="Type your message...">
  <button onclick="sendMessage()">Send</button>

  <!-- Reviews & Ratings -->
  <h2>Leave a Review</h2>
  <div class="star-rating">
    <input type="radio" name="rating" id="5-stars" value="5">
    <label for="5-stars">★</label>
    <input type="radio" name="rating" id="4-stars" value="4">
    <label for="4-stars">★</label>
    <input type="radio" name="rating" id="3-stars" value="3">
    <label for="3-stars">★</label>
    <input type="radio" name="rating" id="2-stars" value="2">
    <label for="2-stars">★</label>
    <input type="radio" name="rating" id="1-stars" value="1">
    <label for="1-stars">★</label>
  </div>
  <textarea id="reviewText" placeholder="Write your review..."></textarea><br>
  <button onclick="submitReview()">Submit Review</button>

  <h3>Reviews</h3>
  <div id="reviewsList"></div>

  <!-- Payment Integration -->
  <h2>Choose Payment Method</h2>
  <label>
    <input type="radio" name="paymentMethod" value="paypal" checked> Pay with PayPal
  </label><br>
  <label>
    <input type="radio" name="paymentMethod" value="delivery"> Pay on Delivery
  </label><br>
  <button onclick="processPayment()">Proceed to Payment</button>

  <div id="paypal-button-container"></div>

  <!-- JavaScript for all features -->
  <script>
    // Registration
    document.getElementById('registerForm').addEventListener('submit', async function(event) {
      event.preventDefault();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const response = await fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, password })
      });

      const result = await response.json();
      alert(result.message);
    });

    // Login
    document.getElementById('loginForm').addEventListener('submit', async function(event) {
      event.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      const response = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });

      const result = await response.json();
      alert(result.message);
    });

    // Social Media Login
    function socialLogin(platform) {
      alert('Login with ' + platform + ' is currently in development.');
      // Add logic for social media authentication if required
    }

    // Post Product
    document.getElementById('productForm').addEventListener('submit', async function(event) {
      event.preventDefault();
      const formData = new FormData();
      formData.append('title', document.getElementById('title').value);
      formData.append('description', document.getElementById('description').value);
      formData.append('price', document.getElementById('price').value);
      formData.append('category', document.getElementById('category').value);
      
      const files = document.getElementById('images').files;
      for (let i = 0; i < files.length; i++) {
        formData.append('images', files[i]);
      }

      const response = await fetch('/api/products', {
        method: 'POST',
        body: formData
      });

      const result = await response.json();
      alert(result.message);
    });

    // Search Products
    async function searchProducts() {
      const keyword = document.getElementById('searchKeyword').value;
      const category = document.getElementById('searchCategory').value;
      const minPrice = document.getElementById('minPrice').value;
      const maxPrice = document.getElementById('maxPrice').value;

      const response = await fetch(/api/products/search?keyword=${keyword}&category=${category}&minPrice=${minPrice}&maxPrice=${maxPrice});
      const products = await response.json();

      const searchResults = document.getElementById('searchResults');
      searchResults.innerHTML = '';
      products.forEach(product => {
        const productDiv = `<div>
          <h3>${product.title}</h3>
          <p>${product.description}</p>
          <p>Price: $${product.price}</p>
        </div>`;
        
       searchResults.innerHTML += productDiv;
      });
    }

    // Messaging System
    async function fetchMessages() {
      const response = await fetch('/api/messages');
      const messages = await response.json();

      const messageBox = document.getElementById('messageBox');
      messageBox.innerHTML = '';
      messages.forEach(msg => {
        const msgDiv = `<div class="message ${msg.sender === 'user' ? 'sender' : ''}">
                          ${msg.content}
                        </div>`;
        messageBox.innerHTML += msgDiv;
      });
    }

    async function sendMessage() {
      const messageInput = document.getElementById('messageInput').value;
      const response = await fetch('/api/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content: messageInput })
      });
      const result = await response.json();
      document.getElementById('messageInput').value = ''; // Clear input after sending
      alert(result.message);
      fetchMessages(); // Refresh the message list
    }

    // Reviews & Ratings
    async function submitReview() {
      const rating = document.querySelector('input[name="rating"]:checked').value;
      const reviewText = document.getElementById('reviewText').value;

      const response = await fetch('/api/reviews', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ rating, review: reviewText })
      });

      const result = await response.json();
      alert(result.message);
      loadReviews(); // Refresh reviews list after submission
    }

    async function loadReviews() {
      const response = await fetch('/api/reviews');
      const reviews = await response.json();

      const reviewsList = document.getElementById('reviewsList');
      reviewsList.innerHTML = '';
      reviews.forEach(review => {
        const reviewDiv = `<div>
                             <p>Rating: ${'★'.repeat(review.rating)} ${'☆'.repeat(5 - review.rating)}</p>
                             <p>${review.text}</p>
                           </div>`;
        reviewsList.innerHTML += reviewDiv;
      });
    }

    // Payment Gateway Integration
    async function processPayment() {
      const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
      if (paymentMethod === 'paypal') {
        document.getElementById('paypal-button-container').style.display = 'block';
      } else {
        alert('Please pay on delivery.');
        // Logic for processing in-person payments can be added here
      }
    }

    paypal.Buttons({
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: '100.00' // Example product price
            }
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          alert('Transaction completed by ' + details.payer.name.given_name);
          // Handle successful transaction - e.g., notify the backend
        });
      }
    }).render('#paypal-button-container'); // Display payment button on your web page

    // Fetch messages and reviews when the page loads
    fetchMessages();
    loadReviews();
  </script>

</body>
</html>